<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VaderFlix Media Portal</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>VaderFlix Media Portal</h1>
    </header>
    <main>
      <div id="overseerr-container">
        <iframe
          id="overseerr-frame"
          src="/overseerr/login"
          width="100%"
          height="800px"
          frameborder="0"
          class="overseerr-frame"
          sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation allow-downloads"
        >
          <p>Loading Overseerr...</p>
        </iframe>
      </div>
      <div id="debug-panel" style="margin-top: 20px; padding: 10px; background: #f0f0f0; font-family: monospace;">
        <h3>Debug Information:</h3>
        <div id="debug-output"></div>
      </div>
    </main>
    <script>
      const debugOutput = document.getElementById('debug-output');
      const iframe = document.getElementById('overseerr-frame');
      
      function log(message) {
        const timestamp = new Date().toISOString();
        debugOutput.innerHTML += `<div>[${timestamp}] ${message}</div>`;
      }

      // Initial load
      log('Page loaded, attempting to load Overseerr login...');

      // Handle iframe load events
      iframe.onload = function() {
        try {
          const iframeUrl = iframe.contentWindow.location.href;
          log(`Iframe loaded: ${iframeUrl}`);
          
          // Try to access iframe content
          const iframeDoc = iframe.contentWindow.document;
          log('Successfully accessed iframe document');
          
          // Check for login form
          const loginForm = iframeDoc.querySelector('form');
          if (loginForm) {
            log('Login form found in iframe');
          } else {
            log('No login form found in iframe');
          }
          
          // Check for images
          const images = iframeDoc.querySelectorAll('img');
          log(`Found ${images.length} images in iframe`);
          images.forEach(img => {
            if (!img.complete || img.naturalHeight === 0) {
              log(`Broken image found: ${img.src}`);
            }
          });
        } catch (e) {
          log(`Error accessing iframe content: ${e.message}`);
        }
      };

      // Handle iframe errors
      iframe.onerror = function(error) {
        log(`Iframe error: ${error}`);
        document.getElementById('overseerr-container').innerHTML = 
          '<div class="error-message">Failed to load Overseerr. Please try accessing it directly.</div>';
      };

      // Add click event listener to debug panel
      document.getElementById('debug-panel').addEventListener('click', function() {
        try {
          const iframeUrl = iframe.contentWindow.location.href;
          log(`Current iframe URL: ${iframeUrl}`);
        } catch (e) {
          log(`Cannot access iframe URL: ${e.message}`);
        }
      });
    </script>
  </body>
</html>
