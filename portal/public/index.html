<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VaderFlix Media Portal</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>VaderFlix Media Portal</h1>
    </header>
    <main>
      <div id="overseerr-container">
        <iframe
          id="overseerr-frame"
          src="/overseerr"
          width="100%"
          height="800px"
          frameborder="0"
          class="overseerr-frame"
          sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
        >
          <p>Loading Overseerr...</p>
        </iframe>
      </div>
      <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>Debug Information:</h3>
        <pre id="debug-output"></pre>
      </div>
    </main>
    <script>
      // Debug information
      const debugInfo = {
        isInIframe: window.self !== window.top,
        parentUrl: window.parent.location.href,
        currentUrl: window.location.href,
        referrer: document.referrer
      };
      
      document.getElementById('debug-output').textContent = JSON.stringify(debugInfo, null, 2);

      // Only show the iframe if we're not already in one
      if (!debugInfo.isInIframe) {
        document.getElementById('overseerr-container').style.display = 'block';
      } else {
        document.getElementById('overseerr-container').innerHTML = 
          `<div class="error-message">
            <p>This page is being loaded inside an iframe from: ${debugInfo.parentUrl}</p>
            <p>Please access Overseerr directly at: <a href="/overseerr" target="_blank">/overseerr</a></p>
          </div>`;
      }

      // Handle iframe load errors
      const iframe = document.getElementById('overseerr-frame');
      iframe.onerror = function() {
        document.getElementById('overseerr-container').innerHTML = 
          '<div class="error-message">Failed to load Overseerr. Please try accessing it directly.</div>';
      };

      // Check if the iframe content is accessible
      iframe.onload = function() {
        try {
          const iframeContent = iframe.contentWindow.document;
          if (!iframeContent) {
            throw new Error('Cannot access iframe content');
          }
        } catch (e) {
          document.getElementById('overseerr-container').innerHTML = 
            '<div class="error-message">Overseerr cannot be embedded. Please <a href="/overseerr" target="_blank">open in new window</a></div>';
        }
      };
    </script>
  </body>
</html>
