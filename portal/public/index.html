<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VaderFlix Media Portal</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>VaderFlix Media Portal</h1>
    </header>
    <main>
      <div id="overseerr-container">
        <iframe
          id="overseerr-frame"
          src="/overseerr"
          width="100%"
          height="800px"
          frameborder="0"
          class="overseerr-frame"
          sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
        >
          <p>Loading Overseerr...</p>
        </iframe>
      </div>
    </main>
    <script>
      // Prevent infinite loops by checking if we're already in an iframe
      if (window.self !== window.top) {
        // We're in an iframe, don't load Overseerr
        document.getElementById('overseerr-container').innerHTML = 
          '<div class="error-message">Please access Overseerr directly</div>';
      }

      // Handle iframe load errors
      const iframe = document.getElementById('overseerr-frame');
      iframe.onerror = function() {
        document.getElementById('overseerr-container').innerHTML = 
          '<div class="error-message">Failed to load Overseerr. Please try accessing it directly.</div>';
      };

      // Check if the iframe content is accessible
      iframe.onload = function() {
        try {
          // Try to access iframe content to check if it loaded properly
          const iframeContent = iframe.contentWindow.document;
          if (!iframeContent) {
            throw new Error('Cannot access iframe content');
          }
        } catch (e) {
          document.getElementById('overseerr-container').innerHTML = 
            '<div class="error-message">Overseerr cannot be embedded. Please <a href="/overseerr" target="_blank">open in new window</a></div>';
        }
      };
    </script>
  </body>
</html>
